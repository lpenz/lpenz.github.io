<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Debianization with git-buildpackage</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link rel="me" href="https://cv.lpenz.org" />
<link rel="me" href="https://twitter.com/lpenz" />
<link rel="me" href="https://www.linkedin.com/in/lpenz" />
<link rel="me" href="https://github.com/lpenz" />
<link rel="me" href="https://stackoverflow.com/cv/lpenz" />
<link rel="me" href="mailto:lpenz@lpenz.org" />
<meta name="author" content="Leandro Lisboa Penz"/>
<meta name="description" content="Avulsos by Penz"/>
<style>
html { /* get footer on bottom: */
    position: relative;
    min-height: 100%;
}
body {
    margin-bottom: 30px; /* Margin bottom by footer height */
}
.footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 30px; /* Set the fixed height of the footer here */
    line-height: 30px; /* Vertically center the text there */
    /* background-color: #f5f5f5; */
}
nav.navbar {
    margin-bottom: 2em; /* space between navbar and contents */
}
pre {
    background-color: #f1f1f1;
    border-left: 4px solid #d9d9d9;
    padding: 15px;
}
#title {
    text-align: center;
    margin-bottom: 1em;
    font-size: 2.5rem;
}
h1, h2, h3, h4, h5, h6 { margin-top: 1em; margin-bottom: 1em; }
h1 { font-size: 1.6rem; }
h2 { font-size: 1.4rem; }
h3, h4, h5, h6 { font-size: 1.2rem; }
td > ul { margin-bottom: 0px; }
em {
    color: indigo;
}
div#main {
    padding-bottom: 1em;
}
div.center > img { margin: 0 auto; } /* center images by default */
div#toc {
    background: #f9f9f9 none repeat scroll 0 0;
    border: 1px solid #aaa;
    display: table;
}
div#toc .toctitle {
    font-weight: 700;
    text-align: center;
    margin-top: 1em;
}
div#toc ul {
    padding-right: 1em;
}
div#toc li, div#toc ul, div#toc ul li {
    list-style: outside none none !important;
}
</style>
<link rel="alternate" type="application/rss+xml" title="Whatsnew feed of Avulsos by Penz" href="http://feeds.feedburner.com/lpenz/avulsos/whatsnew.xml"/>
<link rel="alternate" type="application/rss+xml" title="Articles feed of Avulsos by Penz" href="http://feeds.feedburner.com/lpenz/avulsos/articles.xml"/>
<link rel="icon" type="image/png" href="../../media/logo-black.png" />
<meta name="p:domain_verify" content="629162357f7580ddc473183d74c50ef8"/>
<meta name="generator" content="http://txt2tags.sf.net" />

</head>

<body>


<nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <div class="container">
    <a class="navbar-brand" href="../../index.html"><img alt="Avulsos by Penz" src="../../media/logo-white.png" width="20" height="20" class="d-inline-block align-middle" />&nbsp;&nbsp;&nbsp;Avulsos by Penz</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse auto" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto">
		<li
		class="nav-item"
		><a class="nav-link" href="../../index.html">Home</a></li>
		<li
		class="nav-item active"
		><a class="nav-link" href="../../articles/index.html">Articles</a></li>
		<li
		class="nav-item"
		><a class="nav-link" href="../../debian/index.html">Debian</a></li>
		<li
		class="nav-item"
		><a class="nav-link" href="../../about/index.html">About</a></li>
    </div>
    </div>
</nav>

<div class="container" id="main">

<h1 id="title">Debianization with git-buildpackage</h1>


<div class="body" id="body">
<p>
<strong>Updated 2018-04-03</strong>: <em>git-buildpackage</em>'s commands have changed, so this
article had to be fixed; I took the opportunity to improve a few things as
well.
</p>
<p>
After building some useful piece of software, one has to decide how to best
deploy it. In UNIX, the standard way to do that is by publishing the source
code in .tar.gz format and requiring users to compile it.
</p>
<p>
In Debian there is an alternative: using a .deb package. With a .deb package, a
single <code>dpkg -i ${PACKAGE}.deb</code> installs the software.
</p>
<p>
This article explains how to create and support a .deb package for a simple
software maintained in git, by tracking the packaging scheme in a specific
branch on the same repository.
</p>

<section>
<h1>Prerequisites</h1>

<p>
In order to ease the packaging and keep our package warning-free, it should
have in its main repository:
</p>

<ul>
<li>An <code>AUTHORS</code> file with copyright information.
</li>
<li>A manual: <code>${PACKAGE}.1</code> or similar.
</li>
<li>A <code>COPYING</code> file with GPL information or some other license.
</li>
<li>An appropriate build file for the package. For C/C++ programs, I recommend
  using <code>cmake</code>; for python, <code>setup.py</code>, etc.
</li>
</ul>

<p>
These items are not debian-specific and are useful for everyone.
</p>

</section>
<section>
<h1>Initial packaging setup</h1>

<p>
The first step is creating the <code>${PACKAGE}_${VERSION}.orig.tar.gz</code> file. You
can use git itself for that, by running the following commands in the
repository:
</p>

<pre>
PREFIX=${PACKAGE}_${VERSION}
git archive --format=tar --prefix=$PREFIX/ $VERSION | gzip -c &gt; ../$PREFIX.orig.tar.gz
</pre>

<p>
You can check the contents of the archive with <em>tar</em>. If there are extraneous
files in the archive, you can configure git-archove to exclude them by creating
a <code>.gitattributes</code> file; for example:
</p>

<pre>
.gitignore      export-ignore
.gitattributes  export-ignore
.travis.yml     export-ignore
</pre>

<p>
The next step is to create the debian branches in the git repository: on the
debian-upstream branch, we store the upstream source, while the debian-debian
branch holds the debian package data.
This separation provides a cleaner revision history by separating the changes
that affect the software from the changes in the packaging.
</p>
<p>
In order to create these branches, we issue the following commands in the git
repository:
</p>

<pre>
git checkout --orphan debian-upstream
git rm --cached -r .
git clean -xfd
git commit --allow-empty -m 'Start of debian branches.'
git checkout -b debian-debian
</pre>

<p>
That creates both branches as orphans, pointing to an empty root commit.
</p>
<p>
We now use the <code>../${PACKAGE}_${VERSION}.orig.tar.gz</code> file to create the
initial <code>debian</code> directory in the debian-debian branch:
</p>

<pre>
dh_make -s -p ${PACKAGE}_${VERSION}
</pre>

<p>
We can now customize the standard <code>debian</code> directory created. You must edit
the following files: <code>changelog</code>, <code>control</code>, <code>copyright</code> and <code>rules</code>.
Besides those, the <code>compat</code> file must be present; the other files can be
safely removed.
</p>
<p>
After changing the files that <code>dh_make</code> created, you should create a
<code>debian/gbp.conf</code> with the following contents:
</p>

<pre>
[DEFAULT]
upstream-branch=debian-upstream
debian-branch=debian-debian
</pre>

<p>
We can now commit the debian directory in the debian-debian branch.
</p>

</section>
<section>
<h1>Importing the sources</h1>

<p>
In the debian-debian branch:
</p>

<pre>
gbp import-orig --no-interactive ../${PACKAGE}_${VERSION}.orig.tar.gz
</pre>

<p>
That imports the original sources to the debian-upstream branch, and merge
it into the debian-debian branch.
</p>

</section>
<section>
<h1>Creating the package</h1>

<p>
To create the debian package:
</p>

<pre>
gbp buildpackage -us -uc --git-tag
</pre>

</section>
<section>
<h1>Importing further versions</h1>

<p>
Create the new <code>../${PACKAGE}_${VERSION}/.orig.tar.gz</code> and then:
</p>

<pre>
gbp import-orig --no-interactive ../${PACKAGE}_${VERSION}.orig.tar.gz
</pre>

<p>
Edit the <code>debian/changelog</code> file (we can use <code>dch -i -v $VERSION</code> for
that), and create a new package:
</p>

<pre>
gbp buildpackage -us -uc --git-tag
</pre>

<p>
Yes, it's that easy.
</p>

</section>
<section>
<h1>Final remarks</h1>

<p>
After an initial expensive setup, package creation of further versions is
mostly painless, which is the whole point of git-buildpackage and friends.
</p>
<p>
Besides this article, we should check the <code>debian</code> dir of some already packaged
software for reference. We can look at the
<a href="https://github.com/lpenz/execpermfix">execpermfix</a> repository at
<a href="https://github.com">github</a> when first trying to package something.
</p>
<p>
Further information:
</p>

<ul>
<li><a href="https://www.eyrie.org/~eagle/notes/debian/git.html">https://www.eyrie.org/~eagle/notes/debian/git.html</a>
</li>
<li><a href="http://honk.sigxcpu.org/projects/git-buildpackage/manual-html/gbp.html">http://honk.sigxcpu.org/projects/git-buildpackage/manual-html/gbp.html</a>
</li>
<li><a href="http://www.debian-administration.org/article/Rolling_your_own_Debian_packages_part_1">http://www.debian-administration.org/article/Rolling_your_own_Debian_packages_part_1</a>
</li>
</ul>

</section>
</div>


</div><!--container-->

<div class="footer bg-dark text-light">
	<div class="container">
		<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0; vertical-align:middle;" src="https://licensebuttons.net/l/by-sa/3.0/80x15.png" /></a>
		This work by <a href="mailto:lpenz@lpenz.org">Leandro Lisboa Penz</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
	</div>
</div>

<!-- Other invisible stuff and javascripts: -->

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


</body>

</html>
<!-- vim: ft=html
-->

