
import os
import glob

Import(['env'])

env.Command('Packages.gz',  glob.glob('incoming/*.deb'), 'apt-ftparchive packages . | gzip -9c > ${TARGET.file}.tmp && mv ${TARGET.file}.tmp ${TARGET.file}', chdir=1)
env.Command('Sources.gz',   glob.glob('incoming/*.dsc'), 'apt-ftparchive sources  . | gzip -9c > ${TARGET.file}.tmp && mv ${TARGET.file}.tmp ${TARGET.file}', chdir=1)
env.Command('Contents.gz',  glob.glob('incoming/*.deb'), 'apt-ftparchive contents . | gzip -9c > ${TARGET.file}.tmp && mv ${TARGET.file}.tmp ${TARGET.file}', chdir=1)
env.Command('Release',   ['Packages.gz', 'Sources.gz'], 'apt-ftparchive -o APT::FTPArchive::Release::Label=lpenz release . > ${TARGET.file}.tmp && mv ${TARGET.file}.tmp ${TARGET.file}', chdir=1)
env.Command('Release.gpg', 'Release', 'gpg --output ${TARGET.file} -ba ${SOURCE.file}', chdir=1)

env.Command('main', [], 'ln -s . $TARGET')
env.Command('lpenz', [], 'ln -s . $TARGET')
env.Command('dists', [], 'ln -s . $TARGET')
env.Command('binary-i386', [], 'ln -s . $TARGET')

indexbuild = env.File('indexbuild')
env.Command('index.t2t', ['lpenz.list']+env.Glob('incoming/*.changes'), indexbuild.abspath + ' ${TARGET} ${SOURCES}')
env.Depends('index.t2t', indexbuild)

env.RENDER('index.t2t')


